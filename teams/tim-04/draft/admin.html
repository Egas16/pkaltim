<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liangpran Admin â€” Control Room</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Mono&display=swap"
        rel="stylesheet">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        :root {
            --earth-dark: #1a1a1a;
            --earth-green: #2D3A3A;
            --earth-brown: #8C7E6A;
            --earth-light: #F4F1EA;
            --mist: #E0E5E5;
        }

        body {
            background-color: var(--earth-light);
            color: var(--earth-dark);
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3,
        h4,
        h5 {
            font-family: 'Playfair Display', serif;
        }

        .font-mono {
            font-family: 'Space Mono', monospace;
        }

        /* Login Styling */
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('./assets/hero-mountain.png');
            background-size: cover;
            background-position: center;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Sidebar Styling */
        .sidebar {
            min-height: 100vh;
            background-color: var(--earth-green);
            color: var(--earth-light);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-link {
            color: rgba(244, 241, 234, 0.6);
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 1rem 0;
            transition: all 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--earth-light);
            padding-left: 10px;
        }

        .nav-link.text-danger:hover {
            color: #ff6b6b;
        }

        /* Card components */
        .card-stat {
            border: none;
            border-radius: 2px;
            background: #fff;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .card-stat h5 {
            font-size: 0.9rem;
            opacity: 0.7;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
        }

        .card-stat p {
            font-size: 2.5rem;
            font-family: 'Playfair Display', serif;
            margin: 0;
            color: var(--earth-green);
        }

        /* Table Styling */
        .table-custom {
            background: white;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .table-custom thead {
            background-color: var(--earth-green);
            color: white;
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .table-custom th,
        .table-custom td {
            padding: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        /* Buttons */
        .btn-earth {
            background-color: var(--earth-brown);
            color: white;
            border-radius: 2px;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .btn-earth:hover {
            background-color: #7a6e5d;
            color: white;
        }

        .btn-outline-earth {
            border: 1px solid var(--earth-brown);
            color: var(--earth-brown);
            border-radius: 2px;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .btn-outline-earth:hover {
            background-color: var(--earth-brown);
            color: white;
        }
    </style>
</head>

<body>

    <!-- 1. LOGIN SECTION -->
    <section id="login-section" class="login-container">
        <div class="card login-card shadow-lg" style="width: 400px;">
            <div class="card-body p-5">
                <h3 class="text-center mb-1 fst-italic">Liangpran.</h3>
                <p class="text-center text-muted font-mono small mb-4">SYSTEM ACCESS</p>
                <div id="login-alert" class="alert alert-danger d-none rounded-0 py-2 small"></div>
                <form id="login-form">
                    <div class="mb-3">
                        <label class="form-label small font-mono text-muted">USERNAME</label>
                        <input type="text" id="username" class="form-control rounded-0 border-secondary-subtle"
                            placeholder="admin" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small font-mono text-muted">CODE</label>
                        <input type="password" id="password" class="form-control rounded-0 border-secondary-subtle"
                            placeholder="..." required>
                    </div>
                    <button type="submit" class="btn btn-earth w-100 py-2 mt-2">Enter System</button>
                    <div class="text-center mt-3">
                        <a href="liangpran-journey.html" class="text-decoration-none small text-muted font-mono"><i
                                class="bi bi-arrow-left"></i> Back to Nature</a>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- 2. DASHBOARD SECTION -->
    <section id="dashboard-section" class="dashboard-container">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 sidebar p-4 d-none d-md-block">
                    <h4 class="mb-5 fst-italic">Liangpran.</h4>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2">
                            <a class="nav-link active" href="#"><i class="bi bi-grid me-3"></i> Dashboard</a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="#"><i class="bi bi-tree me-3"></i> Nature Data</a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="#"><i class="bi bi-people me-3"></i> Culture</a>
                        </li>
                        <li class="nav-item mt-5 pt-5 border-top border-secondary">
                            <a class="nav-link text-danger" href="#" onclick="System.auth.logout()"><i
                                    class="bi bi-door-open me-3"></i> Exit System</a>
                        </li>
                    </ul>
                </div>

                <!-- Main Content -->
                <div class="col-md-10 p-5">
                    <div class="d-flex justify-content-between align-items-end mb-5">
                        <div>
                            <span class="font-mono text-muted uppercase tracking-widest small">Overview</span>
                            <h2 class="display-6 mt-1">Content Management</h2>
                        </div>
                        <div class="d-flex gap-3">
                            <button class="btn btn-outline-earth" onclick="System.db.reset()">Reset Data</button>
                            <button class="btn btn-earth" data-bs-toggle="modal" data-bs-target="#dataModal"
                                onclick="prepareCreate()"><i class="bi bi-plus-lg me-2"></i> New Entry</button>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="row mb-5">
                        <div class="col-md-3">
                            <div class="card-stat">
                                <h5>Active Visitors</h5>
                                <p id="stat-visitors">1,204</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card-stat">
                                <h5>Total Entries</h5>
                                <p id="stat-destinations">0</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card-stat bg-success text-white"
                                style="background-color: var(--earth-brown) !important;">
                                <h5 class="text-white-50">System Status</h5>
                                <p class="fs-5 mt-2 font-mono">ALL SYSTEMS OPERATIONAL<br><span
                                        class="fs-6 opacity-50">v3.0.1 Stable</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="table-custom">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Preview</th>
                                    <th>Title & Description</th>
                                    <th>Category</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                <!-- JS Rendered -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal (Create/Edit) -->
    <div class="modal fade" id="dataModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-1 border-0 shadow-lg">
                <div class="modal-header bg-light border-0">
                    <h5 class="modal-title font-serif" id="modalTitle">Add New Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="crud-form">
                        <input type="hidden" id="dataId">
                        <div class="mb-3">
                            <label class="form-label small font-mono text-muted">HEADLINE</label>
                            <input type="text" id="dataTitle" class="form-control rounded-0" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label small font-mono text-muted">CATEGORY</label>
                                <select id="dataCategory" class="form-select rounded-0">
                                    <option value="1">Nature</option>
                                    <option value="2">Culture</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label small font-mono text-muted">LAYOUT TYPE</label>
                                <select id="dataType" class="form-select rounded-0">
                                    <option value="image">Standard Card</option>
                                    <option value="pattern">Pattern Card</option>
                                    <option value="river">River Card</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small font-mono text-muted">NARRATIVE</label>
                            <textarea id="dataDesc" class="form-control rounded-0" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-outline-secondary rounded-0 btn-sm"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-earth rounded-0" onclick="saveData()">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- System Logic -->
    <script src="./system.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- UI Logic ---
        const sections = {
            login: document.getElementById('login-section'),
            dashboard: document.getElementById('dashboard-section')
        };
        const loginForm = document.getElementById('login-form');
        const crudForm = document.getElementById('crud-form');
        const modalEl = document.getElementById('dataModal');
        let bsModal = null;

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            bsModal = new bootstrap.Modal(modalEl);
            checkAuth();
            renderTable();
        });

        function checkAuth() {
            if (System.auth.requireAuth()) {
                sections.login.style.display = 'none';
                sections.dashboard.style.display = 'block';
                updateStats();
            } else {
                sections.login.style.display = 'flex';
                sections.dashboard.style.display = 'none';
            }
        }

        // Login Handler
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const res = System.auth.login(u, p);

            if (res.success) {
                checkAuth();
            } else {
                const alert = document.getElementById('login-alert');
                alert.textContent = res.message;
                alert.classList.remove('d-none');
            }
        });

        // Dashboard Stats
        function updateStats() {
            const data = System.db.getAll('main_data');
            document.getElementById('stat-destinations').textContent = data.length;
        }

        // Render Table
        function renderTable() {
            const tbody = document.getElementById('data-table-body');
            const data = System.db.getAll('main_data');
            const categories = System.db.getAll('categories');

            tbody.innerHTML = data.map(item => {
                const cat = categories.find(c => c.id == item.category_id)?.name || 'Unknown';
                const catBadge = item.category_id == 1
                    ? '<span class="badge bg-success bg-opacity-75 font-mono fw-normal">NATURE</span>'
                    : '<span class="badge bg-warning bg-opacity-75 text-dark font-mono fw-normal">CULTURE</span>';

                const imgDisplay = item.image
                    ? `<img src="${item.image}" width="60" height="40" class="rounded-1 object-fit-cover">`
                    : '<div class="bg-light d-flex align-items-center justify-content-center rounded-1 border" style="width:60px; height:40px;"><i class="bi bi-image text-muted"></i></div>';

                return `
                <tr>
                    <td class="font-mono text-muted align-middle small">#${item.id}</td>
                    <td class="align-middle">${imgDisplay}</td>
                    <td class="align-middle">
                        <div class="fw-bold font-serif fs-5">${item.title}</div>
                        <div class="text-muted small text-truncate" style="max-width: 300px;">${item.desc}</div>
                    </td>
                    <td class="align-middle">${catBadge}</td>
                    <td class="text-end align-middle">
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="editData(${item.id})"><i class="bi bi-pencil-fill"></i></button>
                        <button class="btn btn-sm btn-outline-danger border-0" onclick="deleteData(${item.id})"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>
                `;
            }).join('');
        }

        // CRUD UI Helpers
        function prepareCreate() {
            document.getElementById('modalTitle').textContent = 'Add New Data';
            document.getElementById('dataId').value = '';
            crudForm.reset();
        }

        function editData(id) {
            const item = System.db.getById('main_data', id);
            if (!item) return;

            document.getElementById('modalTitle').textContent = 'Edit Data';
            document.getElementById('dataId').value = item.id;
            document.getElementById('dataTitle').value = item.title;
            document.getElementById('dataCategory').value = item.category_id;
            document.getElementById('dataDesc').value = item.desc;
            document.getElementById('dataType').value = item.type;

            bsModal.show();
        }

        function saveData() {
            const id = document.getElementById('dataId').value;
            const payload = {
                title: document.getElementById('dataTitle').value,
                category_id: parseInt(document.getElementById('dataCategory').value),
                desc: document.getElementById('dataDesc').value,
                type: document.getElementById('dataType').value,
                image: (document.getElementById('dataType').value === 'pattern') ? null : './assets/nature-forest.png' // Mock image assignment
            };

            if (id) {
                System.db.update('main_data', id, payload);
            } else {
                System.db.create('main_data', payload);
            }

            bsModal.hide();
            renderTable();
            updateStats();
        }

        function deleteData(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                System.db.delete('main_data', id);
                renderTable();
                updateStats();
            }
        }
    </script>
</body>

</html>